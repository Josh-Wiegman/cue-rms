<ui-shell>
  <content class="sales-content">
    <div class="sales-header">
      <div>
        <p class="eyebrow">Commercial</p>
        <h1>Sales Orders</h1>
        <p class="subtitle">
          Search, filter, and drill into sales orders across all branches.
        </p>
      </div>
      <div class="actions">
        <button class="secondary" type="button" (click)="clearFilters()">
          Clear filters
        </button>
        <button class="primary" type="button" (click)="openCreateModal()">
          + Create sales order
        </button>
      </div>
    </div>

    <div class="filters">
      <input
        type="search"
        placeholder="Search by sales order, title, or account manager"
        [(ngModel)]="searchTerm"
      />

      <label class="inline-control">
        <span>Branch</span>
        <select [(ngModel)]="branchFilter">
          <option *ngFor="let branch of branches" [value]="branch">
            {{ branch }}
          </option>
        </select>
      </label>

      <label class="inline-control">
        <span>Start from</span>
        <input type="date" [(ngModel)]="dateFrom" />
      </label>

      <label class="inline-control">
        <span>End by</span>
        <input type="date" [(ngModel)]="dateTo" />
      </label>
    </div>

    <div class="table-wrapper" *ngIf="filteredOrders.length; else emptyState">
      <table>
        <thead>
          <tr>
            <th>Sales Order #</th>
            <th>Title</th>
            <th>Account Manager</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Branch</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let order of filteredOrders"
            [routerLink]="['/sales', order.orderNumber]"
          >
            <td>{{ order.orderNumber }}</td>
            <td>{{ order.title }}</td>
            <td>{{ order.accountManager }}</td>
            <td>{{ order.startDate | date: 'dd MMM yyyy' }}</td>
            <td>{{ order.endDate | date: 'dd MMM yyyy' }}</td>
            <td>{{ order.branch }}</td>
            <td>{{ order.status }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <ng-template #emptyState>
      <div class="empty-state">
        <p>No sales orders match your filters.</p>
      </div>
    </ng-template>

    <div class="modal-backdrop" *ngIf="showCreateModal" (click)="closeCreateModal()">
      <div class="modal" (click)="$event.stopPropagation()">
        <header class="modal__header">
          <div>
            <p class="eyebrow">Create order</p>
            <h2>New sales order</h2>
          </div>
          <button
            type="button"
            class="modal__close"
            aria-label="Close create form"
            (click)="closeCreateModal()"
          >
            Ã—
          </button>
        </header>

        <div class="modal__body">
          <label>
            <span>Title</span>
            <input type="text" [(ngModel)]="newOrder.title" />
          </label>
          <label>
            <span>Account manager</span>
            <input type="text" [(ngModel)]="newOrder.accountManager" />
          </label>
          <label>
            <span>Customer</span>
            <input type="text" [(ngModel)]="newOrder.customer" />
          </label>
          <label>
            <span>Branch</span>
            <input type="text" [(ngModel)]="newOrder.branch" />
          </label>
          <label>
            <span>Delivery location</span>
            <input type="text" [(ngModel)]="newOrder.deliveryLocation" />
          </label>
          <label>
            <span>Service branch</span>
            <input type="text" [(ngModel)]="newOrder.serviceBranch" />
          </label>
          <label>
            <span>Order type</span>
            <select [(ngModel)]="newOrder.orderType">
              <option value="Production">Production</option>
              <option value="Dry Hire">Dry Hire</option>
              <option value="Stock Transfer">Stock Transfer</option>
            </select>
          </label>
          <label>
            <span>Start date</span>
            <input type="date" [(ngModel)]="newOrder.startDate" />
          </label>
          <label>
            <span>End date</span>
            <input type="date" [(ngModel)]="newOrder.endDate" />
          </label>
        </div>

        <footer class="modal__actions">
          <button type="button" class="secondary" (click)="closeCreateModal()">
            Cancel
          </button>
          <button type="button" class="primary" (click)="createOrder()">
            Create sales order
          </button>
        </footer>
      </div>
    </div>
  </content>
</ui-shell>
