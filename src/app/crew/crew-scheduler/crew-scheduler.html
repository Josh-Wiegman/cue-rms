<ui-shell>
  <content>
    <h1>Crew Scheduler</h1>

    <div class="view-selector">
      <label>View: </label>
      <select [(ngModel)]="currentView">
        <option value="week">Week View</option>
        <option value="day">Day View</option>
      </select>
    </div>

    <div *ngIf="currentView === 'week'">
      <h2>
        Week View:
        {{ weekRange.start | date: "d MMM" }} –
        {{ weekRange.end | date: "d MMM y" }}
      </h2>

      <div class="week-nav">
        <button (click)="prevWeek()">⬅️ Previous</button>
        <button (click)="nextWeek()">Next ➡️</button>
      </div>

      <table>
        <tr>
          <th>Job Name</th>
          <th>Type</th>
          <th>Start Time</th>
          <th>End Time</th>
          <th>Vehicle</th>
        </tr>

        <ng-container *ngFor="let group of groupedJobs">
          <tr class="date-header">
            <td colspan="5">{{ group.start_date | date: "EEEE, d MMMM y" }}</td>
          </tr>

          <ng-container *ngFor="let job of group.jobs">
            <tr class="job-header">
              <td>{{ job.job_name }}</td>
              <td colspan="4"></td>
            </tr>

            <tr *ngFor="let line of job.job_lines">
              <td></td>
              <td>{{ typeLabels[line.type] || line.type }}</td>
              <td>
                <input type="datetime-local" [(ngModel)]="line.start_time" />
              </td>
              <td>
                <input type="datetime-local" [(ngModel)]="line.end_time" />
              </td>
              <td>
                <select [(ngModel)]="line.vehicle">
                  <option *ngFor="let v of vehicles" [value]="v">
                    {{ v }}
                  </option>
                </select>
              </td>
            </tr>
          </ng-container>
        </ng-container>
      </table>
    </div>

    <div *ngIf="currentView === 'day'">
      <h2>Day View</h2>

      <label>Select Date: </label>
      <input type="date" [(ngModel)]="selectedDate" />

      <table *ngIf="selectedDate">
        <tr>
          <th>Job Name</th>
          <th>Type</th>
          <th>Start Time</th>
          <th>End Time</th>
          <th>Vehicle</th>
        </tr>

        <ng-container *ngFor="let job of jobsForDate(selectedDate)">
          <tr class="job-header">
            <td>{{ job.job_name }}</td>
            <td colspan="4"></td>
          </tr>

          <tr *ngFor="let line of job.job_lines">
            <td></td>
            <td>{{ typeLabels[line.type] || line.type }}</td>
            <td>
              <input type="datetime-local" [(ngModel)]="line.start_time" />
            </td>
            <td><input type="datetime-local" [(ngModel)]="line.end_time" /></td>
            <td>
              <select [(ngModel)]="line.vehicle">
                <option *ngFor="let v of vehicles" [value]="v">{{ v }}</option>
              </select>
            </td>
          </tr>
        </ng-container>
      </table>
    </div>
  </content>
</ui-shell>
